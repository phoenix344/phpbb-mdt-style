{% for row in postrow %}
{% EVENT viewtopic_body_row_post_before %}
<li class="mdt-post mdt-post-variant">
  <header>
    <time datetime="{{ row.POST_DATE_RFC3339 }}">{{ row.POST_DATE }}</time>
  </header>
  <section>
    <p>{{ row.MESSAGE }}</p>
  </section>
  <aside class="mdt-user">
    <figure class="mdt-user-avatar">
      {% EVENT viewtopic_body_avatar_before %}
      {% if row.U_POST_AUTHOR %}
      <a href="{{ row.U_POST_AUTHOR }}">
      {% endif %}
        {% if row.POSTER_AVATAR %}
        {{ row.POSTER_AVATAR }}
        {% else %}
        <i class="material-icons">person</i>
        {% endif %}
      {% if row.U_POST_AUTHOR %}
      </a>
      {% endif %}
      {% EVENT viewtopic_body_avatar_after %}
    </figure>

    {% EVENT viewtopic_body_post_author_before %}
    <span class="mdt-user-name">
      {{ row.POST_AUTHOR_FULL }}
      {{ include('topic/topic_posts_contact.html') }}
    </span>
    {% EVENT viewtopic_body_post_author_after %}

    {% EVENT viewtopic_body_row_rank_before %}
    {% if row.RANK_TITLE and row.RANK_IMG %}
    <figure>
      {{ row.RANK_IMG }}
      <figcaption>{{ row.RANK_TITLE }}</figcaption>
    </figure>
    {% elseif row.RANK_TITLE %}
    <span>{{ row.RANK_TITLE }}</span>
    {% elseif row.RANK_IMG %}
    <span>{{ row.RANK_IMG }}</span>
    {% endif %}
    {% EVENT viewtopic_body_row_rank_after %}

  </aside>
  <footer>
    {% if row.S_POST_HIDDEN %}
    {% if row.S_POST_DELETED %}
    <div class="ignore" id="post_hidden{{ row.POST_ID }}">
      {{ row.L_POST_DELETED_MESSAGE }}<br />
      {{ row.L_POST_DISPLAY }}
    </div>
    {% elseif row.S_IGNORE_POST %}
    <div class="ignore" id="post_hidden{{ row.POST_ID }}">
      {{ row.L_IGNORE_POST }}<br />
      {{ row.L_POST_DISPLAY }}
    </div>
    {% endif %}
    {% endif %}
  </footer>
</li>

<li id="p{{ row.POST_ID }}" class="mdt-grid-post{% if S_UNREAD_VIEW %} mdt-post-unread{% endif %}">
  <header>
    {% if row.S_POST_HIDDEN %}
    {% if row.S_POST_DELETED %}
    <div class="ignore" id="post_hidden{{ row.POST_ID }}">
      {{ row.L_POST_DELETED_MESSAGE }}<br />
      {{ row.L_POST_DISPLAY }}
    </div>
    {% elseif row.S_IGNORE_POST %}
    <div class="ignore" id="post_hidden{{ row.POST_ID }}">
      {{ row.L_IGNORE_POST }}<br />
      {{ row.L_POST_DISPLAY }}
    </div>
    {% endif %}
    {% endif %}
  </header>
  <section>
    <header>
      <h3{% if row.S_FIRST_ROW %} class="first"{% endif %}>
        {% if row.POST_ICON_IMG %}
          <img src="{{ T_ICONS_PATH }}{{ row.POST_ICON_IMG }}" width="{{ row.POST_ICON_IMG_WIDTH }}" height="{{ row.POST_ICON_IMG_HEIGHT }}" alt="{{ row.POST_ICON_IMG_ALT }}" title="{{ row.POST_ICON_IMG_ALT }}">
        {% endif %}
        <a{% if row.S_FIRST_UNREAD %} class="first-unread"{% endif %} href="{{ row.U_MINI_POST }}">{{ row.POST_SUBJECT }}</a>
      </h3>
    </header>
    <p>{{ row.MESSAGE }}</p>
  </section>
  <aside class="mdt-user">
    <div class="mdt-user-content">
      <header>{% EVENT viewtopic_body_avatar_before %}</header>
      <figure class="mdt-user-avatar">
        {% if row.U_POST_AUTHOR %}
        <a href="{{ row.U_POST_AUTHOR }}">
        {% endif %}
          {% if row.POSTER_AVATAR %}
          {{ row.POSTER_AVATAR }}
          {% else %}
          <i class="material-icons">person</i>
          {% endif %}
        {% if row.U_POST_AUTHOR %}
        </a>
        {% endif %}
      </figure>
      <footer>{% EVENT viewtopic_body_avatar_after %}</footer>
    </div>

    <div class="mdt-user-info">
      <header>{% EVENT viewtopic_body_post_author_before %}</header>
      <section>
        {% if not row.U_POST_AUTHOR %}
        <strong>{{ row.POST_AUTHOR_FULL }}</strong>
        {% else %}
        {{ row.POST_AUTHOR_FULL }}
        {% endif %}
      </section>
      <footer>{% EVENT viewtopic_body_post_author_after %}</footer>
    </div>

    {% if row.RANK_TITLE or row.RANK_IMG %}
    <div class="mdt-user-info">
      <header>{% EVENT viewtopic_body_row_rank_before %}</header>
      {% if row.RANK_TITLE and row.RANK_IMG %}
      <figure>
        {{ row.RANK_IMG }}
        <figcaption>{{ row.RANK_TITLE }}</figcaption>
      </figure>
      {% elseif row.RANK_TITLE %}
      <section>{{ row.RANK_TITLE }}</section>
      {% elseif row.RANK_IMG %}
      <figure>{{ row.RANK_IMG }}</figure>
      {% endif %}
      <footer>{% EVENT viewtopic_body_row_rank_after %}</footer>
    </div>
    {% endif %}

    <div class="mdt-user-info">
      <div class="mdt-user-info-headline">{{ lang('POSTS') }}</div>
      <div class="mdt-user-info-text">
        {% if row.U_SEARCH !== '' %}
        <a href="{{ row.U_SEARCH }}">
        {% endif %}
        {{ row.POSTER_POSTS }}
        {% if row.U_SEARCH !== '' %}
        </a>
        {% endif %}
      </div>
    </div>

    {% if row.POSTER_JOINED %}
    <div class="mdt-user-info">
      <div class="mdt-user-info-headline">{{ lang('JOINED') }}</div>
      <div class="mdt-user-info-text">{{ row.POSTER_JOINED }}</div>
    </div>
    {% endif %}

    {% if row.POSTER_WARNINGS %}
    <div class="mdt-user-info">
      <div class="mdt-user-info-headline">{{ lang('WARNINGS') }}{{ lang('COLON') }}</div>
      <div class="mdt-user-info-text">{{ row.POSTER_WARNINGS }}</div>
    </div>
    {% endif %}
    {{ row.TEST_FIELD_NAME }}

    <dl class="postprofile" id="profile{{ row.POST_ID }}"{% if row.S_POST_HIDDEN %} style="display: none;"{% endif %}>


		{% if row.S_PROFILE_FIELD1 %}
			<!-- Use a construct like this to include admin defined profile fields. Replace FIELD1 with the name of your field. -->
			<dd><strong>{{ row.PROFILE_FIELD1_NAME }}{{ lang('COLON') }}</strong> {{ row.PROFILE_FIELD1_VALUE }}</dd>
		{% endif %}


		{% EVENT viewtopic_body_contact_fields_before %}
		{% if not S_IS_BOT and row.contact %}
			<dd class="profile-contact">
				<strong>{{ lang('CONTACT') }}{{ lang('COLON') }}</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="{{ row.CONTACT_USER }}">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">{{ row.CONTACT_USER }}</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
							<!-- TODO: contact -->
						</div>
					</div>
				</div>
			</dd>
		{% endif %}
		{% EVENT viewtopic_body_contact_fields_after %}

		</dl>
  </aside>
</li>
	
	{% if row.S_FIRST_UNREAD %}
  <a id="unread" class="anchor"{% if S_UNREAD_VIEW %} data-url="{{ row.U_MINI_POST }}"{% endif %}></a>
	{% endif %}
	<div id="p{{ row.POST_ID }}" class="post has-profile {% if row.S_ROW_COUNT is odd %}bg1{% else %}bg2{% endif %}{% if row.S_UNREAD_POST %} unreadpost{% endif %}{% if row.S_POST_REPORTED %} reported{% endif %}{% if row.S_POST_DELETED %} deleted{% endif %}{% if row.S_ONLINE and not row.S_POST_HIDDEN %} online{% endif %}{% if row.POSTER_WARNINGS %} warned{% endif %}">
		<div class="inner">

		<div class="postbody">
			{% if row.S_POST_HIDDEN %}
				{% if row.S_POST_DELETED %}
					<div class="ignore" id="post_hidden{{ row.POST_ID }}">
						{{ row.L_POST_DELETED_MESSAGE }}<br />
						{{ row.L_POST_DISPLAY }}
					</div>
				{% elseif row.S_IGNORE_POST %}
					<div class="ignore" id="post_hidden{{ row.POST_ID }}">
						{{ row.L_IGNORE_POST }}<br />
						{{ row.L_POST_DISPLAY }}
					</div>
				{% endif %}
			{% endif %}
			<div id="post_content{{ row.POST_ID }}"{% if row.S_POST_HIDDEN %} style="display: none;"{% endif %}>

			{% EVENT viewtopic_body_post_subject_before %}
		<h3 {% if row.S_FIRST_ROW %}class="first"{% endif %}>
			{% if row.POST_ICON_IMG %}
				<img src="{{ T_ICONS_PATH }}{{ row.POST_ICON_IMG }}" width="{{ row.POST_ICON_IMG_WIDTH }}" height="{{ row.POST_ICON_IMG_HEIGHT }}" alt="{{ row.POST_ICON_IMG_ALT }}" title="{{ row.POST_ICON_IMG_ALT }}">
			{% endif %}
			<a {% if row.S_FIRST_UNREAD %}class="first-unread" {% endif %}href="{{ row.U_MINI_POST }}">{{ row.POST_SUBJECT }}</a>
		</h3>

    {% set SHOW_POST_BUTTON = row.U_EDIT or row.U_DELETE or row.U_REPORT or row.U_WARN or row.U_INFO or row.U_QUOTE %}
		{% EVENT viewtopic_body_post_buttons_list_before %}
		{% if not S_IS_BOT %}
			{% if SHOW_POST_BUTTONS %}
				<ul class="post-buttons">
					{% EVENT viewtopic_body_post_buttons_before %}
					{% if row.U_EDIT %}
						<li>
							<a href="{{ row.U_EDIT }}" title="{{ lang('EDIT_POST') }}" class="button button-icon-only">
								<i class="icon fa-pencil fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_EDIT') }}</span>
							</a>
						</li>
					{% endif %}
					{% if row.U_DELETE %}
						<li>
							<a href="{{ row.U_DELETE }}" title="{{ lang('DELETE_POST') }}" class="button button-icon-only">
								<i class="icon fa-times fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_DELETE') }}</span>
							</a>
						</li>
					{% endif %}
					{% if row.U_REPORT %}
						<li>
							<a href="{{ row.U_REPORT }}" title="{{ lang('REPORT_POST') }}" class="button button-icon-only">
								<i class="icon fa-exclamation fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_REPORT') }}</span>
							</a>
						</li>
					{% endif %}
					{% if row.U_WARN %}
						<li>
							<a href="{{ row.U_WARN }}" title="{{ lang('WARN_USER') }}" class="button button-icon-only">
								<i class="icon fa-exclamation-triangle fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_WARN') }}</span>
							</a>
						</li>
					{% endif %}
					{% if row.U_INFO %}
						<li>
							<a href="{{ row.U_INFO }}" title="{{ lang('INFORMATION') }}" class="button button-icon-only">
								<i class="icon fa-info fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_INFORMATION') }}</span>
							</a>
						</li>
					{% endif %}
					{% if row.U_QUOTE %}
						<li>
							<a href="{{ row.U_QUOTE }}" title="{{ lang('REPLY_WITH_QUOTE') }}" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">{{ lang('BUTTON_QUOTE') }}</span>
							</a>
						</li>
					{% endif %}
					{% EVENT viewtopic_body_post_buttons_after %}
				</ul>
			{% endif %}
		{% endif %}
		{% EVENT viewtopic_body_post_buttons_list_after %}

			{% EVENT viewtopic_body_row_post_details_before %}
			<p class="author">
				{% if S_IS_BOT %}
					<span><i class="icon fa-file fa-fw {% if row.S_UNREAD_POST %}icon-red{% else %}icon-lightgray{% endif %} icon-md" aria-hidden="true"></i><span class="sr-only">{{ row.MINI_POST }}</span></span>
				{% else %}
					<a class="unread" href="{{ row.U_MINI_POST }}" title="{{ row.MINI_POST }}">
						<i class="icon fa-file fa-fw {% if row.S_UNREAD_POST %}icon-red{% else %}icon-lightgray{% endif %} icon-md" aria-hidden="true"></i><span class="sr-only">{{ row.MINI_POST }}</span>
					</a>
				{% endif %}
				<span class="responsive-hide">{{ lang('POST_BY_AUTHOR') }} <strong>{{ row.POST_AUTHOR_FULL }}</strong> &raquo; </span><time datetime="{{ row.POST_DATE_RFC3339 }}">{{ row.POST_DATE }}</time>
			</p>
			{% EVENT viewtopic_body_row_post_details_after %}

			{% if row.S_POST_UNAPPROVED %}
			{% if row.S_CAN_APPROVE %}
			<form method="post" class="mcp_approve" action="{{ row.U_APPROVE_ACTION }}">
				<p class="post-notice unapproved">
					<span><i class="icon fa-question icon-red fa-fw" aria-hidden="true"></i></span>
					<strong>{{ lang('POST_UNAPPROVED_ACTION') }}</strong>
					<input class="button2" type="submit" value="{{ lang('DISAPPROVE') }}" name="action[disapprove]" />
					<input class="button1" type="submit" value="{{ lang('APPROVE') }}" name="action[approve]" />
					<input type="hidden" name="post_id_list[]" value="{{ row.POST_ID }}" />
					{{ S_FORM_TOKEN }}
				</p>
			</form>
			{% else %}
				<p class="post-notice unapproved">
					<span><i class="icon fa-exclamation icon-red fa-fw" aria-hidden="true"></i></span>
					<strong>{{ lang('POST_UNAPPROVED_EXPLAIN') }}</strong>
				</p>
			{% endif %}
			{% elseif row.S_POST_DELETED %}
			<form method="post" class="mcp_approve" action="{{ row.U_APPROVE_ACTION }}">
				<p class="post-notice deleted">
					<strong>{{ lang('POST_DELETED_ACTION') }}</strong>
					{% if row.S_DELETE_PERMANENT %}
						<input class="button2" type="submit" value="{{ lang('DELETE') }}" name="action[delete]" />
					{% endif %}
					<input class="button1" type="submit" value="{{ lang('RESTORE') }}" name="action[restore]" />
					<input type="hidden" name="post_id_list[]" value="{{ row.POST_ID }}" />
					{{ S_FORM_TOKEN }}
				</p>
			</form>
			{% endif %}

			{% if row.S_POST_REPORTED %}
			<p class="post-notice reported">
				<a href="{{ row.U_MCP_REPORT }}"><i class="icon fa-exclamation fa-fw icon-red" aria-hidden="true"></i><strong>{{ lang('POST_REPORTED') }}</strong></a>
			</p>
			{% endif %}

			<div class="content">{{ row.MESSAGE }}</div>

			{% EVENT viewtopic_body_row_content_after %}

      <!-- TODO: attachment -->

			{% EVENT viewtopic_body_row_post_notices_before %}
			{% if row.S_DISPLAY_NOTICE %}<div class="rules">{{ lang('DOWNLOAD_NOTICE') }}</div>{% endif %}
			{% if row.DELETED_MESSAGE or row.DELETE_REASON %}
				<div class="notice post_deleted_msg">
					{{ row.DELETED_MESSAGE }}
					{% if row.DELETE_REASON %}<br /><strong>{{ lang('REASON') }}{{ lang('COLON') }}</strong> <em>{{ row.DELETE_REASON }}</em>{% endif %}
				</div>
			{% elseif row.EDITED_MESSAGE or row.EDIT_REASON %}
				<div class="notice">
					{{ row.EDITED_MESSAGE }}
					{% if row.EDIT_REASON %}<br /><strong>{{ lang('REASON') }}{{ lang('COLON') }}</strong> <em>{{ row.EDIT_REASON }}</em>{% endif %}
				</div>
			{% endif %}

			{% if row.BUMPED_MESSAGE %}<div class="notice"><br /><br />{{ row.BUMPED_MESSAGE }}</div>{% endif %}
			{% EVENT viewtopic_body_row_post_notices_after %}
			{% if row.SIGNATURE %}<div id="sig{{ row.POST_ID }}" class="signature">{{ row.SIGNATURE }}</div>{% endif %}

			{% EVENT viewtopic_body_row_post_content_footer %}
			</div>

		</div>

		{% EVENT viewtopic_body_row_back2top_before %}
		<div class="back2top">
			{% EVENT viewtopic_body_row_back2top_prepend %}
			<a href="#top" class="top" title="{{ lang('BACK_TO_TOP') }}">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">{{ lang('BACK_TO_TOP') }}</span>
			</a>
			{% EVENT viewtopic_body_row_back2top_append %}
		</div>
		{% EVENT viewtopic_body_row_back2top_after %}

		</div>
	</div>

	{% EVENT viewtopic_body_row_post_after %}
{% endfor %}
